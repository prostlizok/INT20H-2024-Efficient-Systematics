# Рішення для виявлення пневмонії від команди Efficient Systematics 

Цей README файл надає повне пояснення рішення та запуску рішення для виявлення пневмонії, 
розробленого для хакатону від команди Efficient Systematics. Рішення включає дві основні моделі: 
модель класифікації для виявлення наявності пневмонії на знімках грудної клітки та модель сегментації 
для ідентифікації та виділення областей, уражених пневмонією. Нижче наведено покроковий посібник 
з підготовки вашого середовища, запуску скриптів підготовки даних, навчання моделей та виконання висновків.

## Передумови

Перед запуском рішення переконайтеся, що ви маєте наступне:

- Python версії 3.8 або новіше встановлено на вашій системі.
- Встановлені необхідні бібліотеки за допомогою файлу `requirements.txt`, який надається у репозиторії. Їх можна встановити за допомогою наступної команди: 
`pip install -r requirements.txt
`


## Підготовка даних

### Набір даних
Розмістіть набір даних у папці `data`. В результаті датасет має бути структурований наступним чином:
```
data/rsna-pneumonia-detection-challenge/
├── stage_2_detailed_class_info.csv
├── stage_2_train_images/
├── stage_2_test_images/
```

### Підготовка датасету до тренування

Після завантаження даних слід запустити команду `python prepare_data.py`
Скрипт `prepare_data.py` робить очистку початкових csv файлів, створює новий output.csv та конвертує зображення з DCIM у JPG формат.

У ході очистки ми позбавляємося NaN значень, чистимо дублікати, поєднуємо класи No Lung Opacity / Not Normal, Normal та мерджимо координати одне з одним, якщо на картинці більше ніж одна маска.

Також ми робимо розподіл дати для тренування по директоріям Normal та Not Normal, паралельно зменшуючи розмір зображення до 256x256px, тому в результаті матимемо наступну струкутру папок:
```
data/
├──rsna-pneumonia-detection-challenge/
    ├── stage_2_detailed_class_info.csv
    ├── stage_2_train_images/
    ├── stage_2_test_images/
├── output.csv
├──temporary/
    ├──train_images/
        ├──Normal/
        ├──Not Normal/
    ├──train_images_jpg/
        ├──Normal/
        ├──Not Normal/
    ├──train_images_masks/
        ├──Normal/
        ├──Not Normal/
├──train_images_resized/
    ├──Normal/
    ├──Not Normal/
├──test_images_jpg/
```

## Навчання моделей

Наше рішення складається з двох моделей:

### 1. Модель класифікації

- **Мета**: Класифікувати, чи містить рентгенівське зображення ознаки пневмонії.
- **Архітектура**: Використовує власну модель на основі DenseNet169 для класифікації зображень.
- **Навчання**: Процес навчання включає аугментацію зображень та навчання моделі розрізняти звичайні та уражені пневмонією рентгенівські зображення.

### 2. Модель сегментації

- **Мета**: Сегментувати та виділити області, уражені пневмонією на рентгенівському зображенні.
- **Архітектура**: Реалізує модель U-Net з основою ResNet18.
- **Навчання**: Навчається на підготовленому наборі даних з масками, щоб навчитися точно сегментувати області пневмонії.

Для навчання моделей запустіть скрипт `train.py`:

`python train.py`

Цей скрипт оброблятиме процес навчання як моделі класифікації, так і моделі сегментації.

## Генерація результату

Після навчання моделі можуть бути використані для прогнозування пневмонії на нових рентгенівських зображеннях грудної клітки. Скрипт `inference.py` завантажує навчені моделі, обробляє вхідні зображення з директорії `test_images_jpg` та виводить прогнози. Прогнози включають інформацію про те, чи виявлено пневмонію на кожному зображенні, і якщо так, то розташування областей з пневмонією.

Запустіть висновок за допомогою: 
`python inference.py`
> Але зауважте, що для генерації submission.csv будуть використовуватися файли з папки data/test_images_jpg.
>
> Для того щоб вказати свою директорію, зайдіть в `inference.py` та в самому низу в коді змініть `images_dir` на свою директорію.
> ```
> if __name__ == '__main__':
>    images_dir = 'data/test_images_jpg'  # or path to your directory with images
>    main(images_dir)
>```

Це створить файл `submission.csv` з прогнозами та обмежувальними рамками для виявлених областей пневмонії у форматі, необхідному для хакатону.



